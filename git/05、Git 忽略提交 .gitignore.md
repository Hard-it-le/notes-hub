
## 前言

日常开发使用 Git 的过程中，我们习惯有些文件比如打印日志文件、临时文件、编译的中间文件等不要提交到代码仓库，这是就需要设置相关代码仓库的忽略规则，忽略这些文件的提交。

## 示例

| 规则        | 作用                         |
| ----------- | ---------------------------- |
| /data       | 过滤整个 data 文件夹               |
| .zip        | 过滤所有的 .zip 文件         |
| /data/a.txt | 过滤某个文件夹下的某一个文件 |
|  !/data/b.txt            |                  不过滤具体文件或者文件夹            |

>如果创建 .gitignore 之前就推送（push） 了某一文件，那么即使在 .gitignore 文件中写入过滤该文件的规则，该规则也不会起作用，Git 仍然会对该文件进行版本管理。

## Git 忽略规则

详细的忽略规则可以参考[官方英文文档](https://Git-scm.com/docs/gitignore)

### Git 忽略文件的原则
-  忽略操作系统自动生成的文件，比如缩略图等
-  忽略编译生成的中间文件、可执行文件等，也就是如果一个文件是通过另一个文件自动生成的，那自动生成的文件就没必要放进版本库，比如 Java 编译产生的 .class 文件  
-  忽略你自己的带有敏感信息的配置文件，比如存放口令的配置文件

### Git 忽略规则优先级

在 .gitingore 文件中，每一行指定一个忽略规则，Git 检查忽略规则的时候有多个来源，它的优先级如下（由高到低）：

-   从命令行中读取可用的忽略规则
-   当前目录定义的规则
-   父级目录定义的规则，依次地类推
-   $Git_DIR/info/exclude 文件中定义的规则
-   core.excludesfile 中定义的全局规则

### Git 忽略规则匹配语法

在 .gitignore 文件中，每一行的忽略规则的语法如下：

-   `空格`不匹配任意文件，可作为分隔符，可用反斜杠转义
-   `# 开头`的模式标识注释，可以使用反斜杠进行转义
-   `! 开头`的模式标识否定，该文件将会再次被包含，**如果排除了该文件的父级目录，则使用 ! 也不会再次被包含**。可以使用反斜杠进行转义
-   `/ 结束`的模式只匹配文件夹以及在该文件夹路径下的内容，但是不匹配该文件
-   `/ 开始`的模式匹配项目跟目录
-   如果一个模式不包含斜杠，则它匹配相对于当前 .gitignore 文件路径的内容，如果该模式不在 .gitignore 文件中，则相对于项目根目录
-   `**` 匹配多级目录，可在开始，中间，结束
-   `?`通用匹配单个字符
-   `[]`通用匹配单个字符列表

> Git 对于 .gitignore 配置文件是按行从上到下进行规则匹配的,意味着如果前面的规则范围更大，则后面的规则将不会生效，比如 / 在文件夹名前，表示根目录下的某个文件夹，/test/ 表示忽略根目录下的 /test/ 目录的全部内容，而 test/ 表示忽略文件夹 test 下的全部内容，不管是根目录下的 /test/ ，还是某个子目录下的 test 文件夹，比如：/child/test，都会被忽略

## Git 忽略文件提交的方法

有三种方法可以实现忽略 Git 中不想提交的文件。

### 1、在 Git 项目中定义 .gitignore 文件

这种方式通过在项目的某个文件夹下定义 .gitignore 文件，在该文件中定义相应的忽略规则，来管理当前文件夹下的文件的 Git 提交行为。

.gitignore 文件是可以提交到共有仓库中，这就为该项目下的所有开发者都共享一套定义好的忽略规则。

在 .Gitingore 文件中，遵循相应的语法，在每一行指定一个忽略规则。如：

```bash
*.target
*.idea
```

### 在 Git 项目的设置中指定排除文件

这种方式只是临时指定该项目的行为，需要编辑当前项目下的 .Git/info/exclude 文件，然后将需要忽略提交的文件写入其中。

需要注意的是，这种方式指定的忽略文件的根目录是项目根目录。

### 定义 Git 全局的 .gitignore 文件

除了可以在项目中定义 .gitignore 文件外，还可以设置全局的 Git .gitignore 文件来管理所有 Git 项目的行为。这种方式在不同的项目开发者之间是不共享的，是属于项目之上 Git 应用级别的行为。

这种方式也需要创建相应的 .gitignore 文件，可以放在任意位置。然后在使用以下命令配置 Git：

```bash
git config --global core.excludesfile ~/.gitignore

```

## **.gitignore 忽略规则查看**

如果你发下 .gitignore 写得有问题，需要找出来到底哪个规则写错了，可以用 git check-ignore 命令检查：

```bash
git check-ignore -v node_modules # -v 路径 
```

## **Git 忽略规则(.gitignore 配置）不生效原因和解决**

- 第一种方法
`.gitignore中已经标明忽略的文件目录下的文件，git push的时候还会出现在push的目录中，或者用git status查看状态，想要忽略的文件还是显示被追踪状态。`

`原因是因为在git忽略目录中，新建的文件在git中会有缓存，如果某些文件已经被纳入了版本管理中，就算是在.gitignore中已经声明了忽略路径也是不起作用的，`

`这时候我们就应该先把本地缓存删除，然后再进行git的提交，这样就不会出现忽略的文件了。`

.gitignore 只能忽略那些原来没有被 track 的文件，如果某些文件已经被纳入了版本管理中，则修改 .gitignore 是无效的。

解决方法就是 Git 先把本地缓存删除（改变成未 track 状态），然后再提交:

```bash
git rm -r --cached .
git add .
git commit -m 'update .gitignore'
git push -u origin master
```

- 第二种方法
`在每个clone下来的仓库中手动设置不要检查特定文件的更改情况。`

```bash
git update-index --assume-unchanged PATH     # 在PATH处输入要忽略的文件
```



### **在使用 .gitignore 文件后如何删除远程仓库中以前上传的此类文件而保留本地文件**

在使用 Git 和 Github 的时候，之前没有写 .gitignore 文件，就上传了一些没有必要的文件，在添加了.gitignore 文件后，就想删除远程仓库中的文件却想保存本地的文件。这时候**不可以直接使用 "git rm directory"**，这样会删除本地仓库的文件。可以使用 "**git rm -r –cached directory**" 来删除缓冲，然后进行 "**commit**" 和 "**push**"，这样会发现远程仓库中的不必要文件就被删除了，以后可以直接使用 "**git add -A**" 来添加修改的内容，上传的文件就会受到 .gitignore 文件的内容约束。